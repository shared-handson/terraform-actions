name: "CI Failure Handler"
description: "PR Comment & Close Action"

inputs:
  message-file:
    required: true
    description: "The message file path."
  github_token:
    required: true
    description: "Github Actions Auth TOKEN"

runs:
  using: "composite"
  steps:
    - name: Add Text PR Comment
      shell: bash
      env:
        TEMP_FILE: ${{ inputs.message-file }}
      run: |
        echo "" >> ${TEMP_FILE}
        cat << "EOF" >> ${TEMP_FILE}
        ### ğŸ”§ ä¿®æ­£å¾Œã®å¯¾å¿œ
        1. ä¸Šè¨˜ã®ã‚¨ãƒ©ãƒ¼ã‚’ã™ã¹ã¦ä¿®æ­£ã—ã¦ãã ã•ã„
        2. ä¿®æ­£å®Œäº†å¾Œã€æ–°ã—ã„PRã‚’ä½œæˆã—ã¦ãã ã•ã„
        3. ã¾ãŸã¯ã€ã“ã®PRã‚’å†ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¦ä¿®æ­£ã‚’pushã—ã¦ãã ã•ã„

        ** 10ç§’å¾Œã«PRã‚’è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã™**
        EOF

    - name: Post PR Comment
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github_token }}
        TEMP_FILE: ${{ inputs.message-file }}
      run: |
        gh pr comment ${{ github.event.pull_request.number }} --body-file ${TEMP_FILE}
        rm -rf ${TEMP_FILE}

    - name: Sleep on Failure
      shell: bash
      run: sleep 10

    - name: PR Close on Failure
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github_token }}
      run: |
        gh pr comment ${{ github.event.pull_request.number }} --body "ğŸš« **PRè‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã™ã€‚**"
        gh pr close ${{ github.event.pull_request.number }}
        exit 1
